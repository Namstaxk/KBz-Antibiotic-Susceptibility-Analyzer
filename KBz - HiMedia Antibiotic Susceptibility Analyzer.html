<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KBz - HiMedia Antimicrobial Susceptibility Analyzer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            background-image:
                linear-gradient(rgba(255, 255, 255, 0.8), rgba(255, 255, 255, 0.8)),
                url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%239C92AC' fill-opacity='0.1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
        .main-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px -10px rgba(0, 20, 50, 0.15);
            border: 1px solid #e5e7eb;
            position: relative;
            overflow: hidden;
        }
        .content-wrapper {
            position: relative;
            z-index: 1;
        }
        .result-card {
            transition: all 0.3s ease-in-out;
            border-width: 1px;
            border-left-width: 5px;
        }
        .result-susceptible { background-color: #f0fdf4; border-color: #22c55e; color: #15803d; }
        .result-intermediate { background-color: #fefce8; border-color: #f59e0b; color: #b45309; }
        .result-resistant { background-color: #fef2f2; border-color: #ef4444; color: #b91c1c; }
        .result-unknown { background-color: #f8fafc; border-color: #64748b; color: #475569; }

        #petri-dish-svg {
            width: 100%;
            max-width: 300px;
            height: auto;
            aspect-ratio: 1 / 1;
            margin: auto;
        }
        #inhibition-zone {
            transition: r 0.4s ease-out, fill 0.4s ease-out;
        }
        .zone-susceptible { fill: #22c55e; }
        .zone-intermediate { fill: #f59e0b; }
        .zone-resistant { fill: #ef4444; }
        .zone-unknown { fill: #9ca3af; }
        
        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #9ca3af; }
        
        .input-group { position: relative; }
        .input-group .fa-solid {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
            z-index: 10;
        }
        .input-group input, .input-group select {
            padding-left: 2.75rem;
            background-color: #f9fafb;
            border-color: #e5e7eb;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
    <div class="main-container w-full max-w-4xl mx-auto p-6 md:p-8">
        <div class="content-wrapper">
            <div class="text-center mb-8">
                <h1 class="text-3xl md:text-4xl font-extrabold text-gray-800 tracking-tight">KBz - HiMedia Antibiotic Susceptibility Analyzer</h1>
                <p class="text-gray-500 mt-3">
                    Determine susceptibility with a visual petri dish representation.
                    <br>
                    <a href="https://www.himedialabs.com/media/Catalogue/literature/microbiology/antimicrobial-susceptibility-systems.pdf" target="_blank" rel="noopener noreferrer" class="text-indigo-600 hover:underline text-sm font-medium">
                        Click here to download HiMedia Susceptibility Test Reference Chart.
                    </a>
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Left Column: Form Controls -->
                <div class="space-y-6">
                    <div>
                        <label for="antibiotic-search" class="block text-sm font-medium text-gray-700 mb-1">Antimicrobial Agent</label>
                        <div class="relative" id="antibiotic-dropdown-container">
                            <div class="input-group">
                                <i class="fa-solid fa-magnifying-glass"></i>
                                <input type="text" id="antibiotic-search" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" placeholder="Search or select an antibiotic">
                            </div>
                            <div id="antibiotic-options" class="absolute z-20 w-full bg-white border rounded-lg mt-1 hidden max-h-60 overflow-y-auto custom-scrollbar shadow-lg">
                                <!-- Options populated by JS -->
                            </div>
                        </div>
                    </div>

                    <div>
                        <label for="microorganism" class="block text-sm font-medium text-gray-700 mb-1">Microorganism</label>
                        <div class="input-group">
                            <i class="fa-solid fa-bacterium"></i>
                            <select id="microorganism" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" disabled>
                                <option value="">Select a microorganism</option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <label for="discContent" class="block text-sm font-medium text-gray-700 mb-1">Disc Content</label>
                        <div class="input-group">
                            <i class="fa-solid fa-database"></i>
                            <select id="discContent" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" disabled>
                                <option value="">Select disc content</option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <label for="diameter" class="block text-sm font-medium text-gray-700 mb-1">Zone of Inhibition Diameter (mm)</label>
                        <div class="input-group">
                            <i class="fa-solid fa-ruler-horizontal"></i>
                            <input type="number" id="diameter" placeholder="e.g., 18" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" disabled>
                        </div>
                    </div>
                </div>

                <!-- Right Column: Visualization and Results -->
                <div class="flex flex-col justify-center items-center space-y-4">
                    <div id="visualization-container" class="w-full p-4 bg-gray-50 rounded-lg border">
                        <svg id="petri-dish-svg" viewBox="0 0 200 200">
                            <defs>
                                <pattern id="lawn" patternUnits="userSpaceOnUse" width="6" height="6">
                                    <circle cx="1.5" cy="1.5" r="1" fill="#d97706" opacity="0.3"/>
                                </pattern>
                                <filter id="dish-shadow" x="-20%" y="-20%" width="140%" height="140%">
                                    <feDropShadow dx="2" dy="4" stdDeviation="3" flood-color="#000" flood-opacity="0.1"/>
                                </filter>
                            </defs>
                            <g filter="url(#dish-shadow)">
                                <circle cx="100" cy="100" r="98" fill="#fefce8" />
                                <circle cx="100" cy="100" r="98" fill="url(#lawn)" />
                                <circle cx="100" cy="100" r="98" fill="transparent" stroke="#d1d5db" stroke-width="2" />
                            </g>
                            <circle cx="100" cy="100" r="94" fill="transparent" stroke="rgba(255,255,255,0.6)" stroke-width="1.5" />

                            <circle id="inhibition-zone" cx="100" cy="100" r="0" class="zone-unknown" opacity="0.85" />
                            <circle cx="100" cy="100" r="6" fill="#ffffff" stroke="#4b5563" stroke-width="1" />
                            <text id="diameter-label" x="100" y="195" font-size="12" text-anchor="middle" fill="#1f2937" font-weight="600">0 mm</text>
                        </svg>
                    </div>
                    <div id="result-container" class="w-full">
                        <div id="result-display" class="result-card p-4 rounded-lg hidden flex items-center space-x-3">
                            <i id="result-icon" class="fa-solid fa-lg"></i>
                            <div>
                                <h3 id="result-title" class="text-lg font-bold"></h3>
                                <p id="result-description" class="text-sm"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="criteria-container" class="mt-8 p-5 bg-slate-50 rounded-lg hidden border">
                <h4 class="text-lg font-bold text-gray-800 mb-4 text-center">Reference Criteria</h4>
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 text-center">
                    <div>
                        <p class="text-sm text-gray-500">Susceptible</p>
                        <p id="ref-susceptible" class="font-bold text-2xl text-green-600">-</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Intermediate</p>
                        <p id="ref-intermediate" class="font-bold text-2xl text-yellow-500">-</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500">Resistant</p>
                        <p id="ref-resistant" class="font-bold text-2xl text-red-600">-</p>
                    </div>
                </div>
            </div>

            <p class="text-center text-xs text-gray-500 mt-8">Project made by Naman Devadiga with ❤️. Happy Learning!!</p>
        </div>
    </div>

    <script>
        // Data from the provided CSV file, with additions for missing antibiotics.
        const csvData = `Antibiotic agent,Micro-organism,Disc Content,Sensitive (mm or more),Intermediate (mm),Resistant (mm or less)
Amikacin," Enterobacteriaceae, P. aeruginosa, Acinetobacter & Staphylococcus spp.",30 mcg,17,15-16,14
Amikacin, Enterobacteriaceae (EUCAST),30 mcg,18,15-17,15
Amikacin, Pseudomonas spp. (EUCAST),30 mcg,18,15-17,15
Amikacin, Staphylococcus spp. (EUCAST),30 mcg,18,16-17,16
Amikacin, Coagulase negative staphylococci (EUCAST),30 mcg,22,19-21,19
Amikacin, Acinetobacter spp. (EUCAST),30 mcg,19,17-18,17
Amoxyclav (Amoxicillin/Clavulanic acid), Enterobacteriaceae & Haemophilus influenzae,30 mcg (20/10),18,14-17,13
Amoxyclav (Amoxicillin/Clavulanic acid), Haemophilus parainfluenzae,30 mcg (20/10),20,-,19
Amoxyclav (Amoxicillin/Clavulanic acid), Enterobacteriaceae (EUCAST),30 mcg (20/10),19,-,19
Amoxyclav (Amoxicillin/Clavulanic acid), Enterobacteriaceae (uncomplicated UTI only) (EUCAST),30 mcg (20/10),16,-,16
Amoxyclav (Amoxicillin/Clavulanic acid), Staphylococcus spp. (EUCAST),30 mcg (20/10),19,-,19
Amoxyclav (Amoxicillin/Clavulanic acid), Enterococcus spp. (EUCAST),30 mcg (20/10),18,-,18
Ampicillin," Enterobacteriaceae, Enterococcus, Listeria & Staphylococcus spp.",10 mcg,17,14-16,13
Ampicillin, Enterobacteriaceae (uncomplicated UTI only) (EUCAST),10 mcg,16,-,16
Ampicillin, Staphylococcus spp. (EUCAST),10 mcg,29,-,29
Ampicillin, Enterococcus spp. (EUCAST),10 mcg,18,-,18
Ampicillin, Haemophilus influenzae (EUCAST),10 mcg,19,-,19
Ampicillin, Listeria monocytogenes (EUCAST),10 mcg,20,-,20
Ampicillin/Sulbactam, Enterobacteriaceae,20 mcg (10/10),15,12-14,11
Ampicillin/Sulbactam, Acinetobacter spp.,20 mcg (10/10),16,13-15,12
Ampicillin/Sulbactam, Staphylococcus spp.,20 mcg (10/10),20,-,19
Azithromycin, Staphylococcus spp.,15 mcg,18,14-17,13
Azithromycin, Streptococcus pneumoniae,15 mcg,18,13-17,12
Azithromycin, Streptococcus group A B C & G,15 mcg,18,14-17,13
Azithromycin, Haemophilus influenzae,15 mcg,12,-,12
Azithromycin, Haemophilus influenzae (EUCAST),15 mcg,12,-,12
Azithromycin, Neisseria gonorrhoeae (EUCAST),15 mcg,30,-,30
Aztreonam, Enterobacteriaceae,30 mcg,22,16-21,15
Aztreonam, Pseudomonas aeruginosa,30 mcg,22,16-21,15
Cefaclor, Enterobacteriaceae,30 mcg,18,15-17,14
Cefepime," Enterobacteriaceae, P. aeruginosa, Acinetobacter & Staphylococcus spp.",30 mcg,18,15-17,14
Cefepime, Enterobacteriaceae (EUCAST),30 mcg,22,19-21,19
Cefepime, Pseudomonas spp. (EUCAST),30 mcg,22,19-21,19
Cefixime, Enterobacteriaceae,5 mcg,19,16-18,15
Cefixime, Neisseria gonorrhoeae,5 mcg,31,-,30
Cefoperazone, Enterobacteriaceae & P. aeruginosa,75 mcg,21,16-20,15
Cefotaxime," Enterobacteriaceae, Staphylococcus spp.",30 mcg,23,15-22,14
Cefotaxime, Enterobacteriaceae (EUCAST),30 mcg,20,17-19,17
Cefotaxime, Staphylococcus spp. (EUCAST),30 mcg,21,-,21
Cefotaxime, Haemophilus influenzae (EUCAST),30 mcg,26,-,26
Cefotaxime, Streptococcus pneumoniae (EUCAST),30 mcg,25,13-24,13
Cefoxitin, Enterobacteriaceae,30 mcg,18,15-17,14
Cefoxitin, Staphylococcus spp.,30 mcg,22,-,21
Cefoxitin, Staphylococcus spp. (EUCAST),30 mcg,22,-,22
Ceftazidime," Enterobacteriaceae, P. aeruginosa, Acinetobacter & Staphylococcus spp.",30 mcg,18,15-17,14
Ceftazidime, Enterobacteriaceae (EUCAST),30 mcg,21,18-20,18
Ceftazidime, Pseudomonas spp. (EUCAST),30 mcg,21,18-20,18
Ceftazidime, Staphylococcus spp. (EUCAST),30 mcg,21,-,21
Ceftriaxone," Enterobacteriaceae, Staphylococcus spp.",30 mcg,23,14-22,13
Ceftriaxone, Enterobacteriaceae (EUCAST),30 mcg,23,20-22,20
Ceftriaxone, Staphylococcus spp. (EUCAST),30 mcg,21,-,21
Ceftriaxone, Streptococcus pneumoniae (EUCAST),30 mcg,25,13-24,13
Cefuroxime, Enterobacteriaceae,30 mcg,18,15-17,14
Cefuroxime, Staphylococcus spp.,30 mcg,18,15-17,14
Cefuroxime, Staphylococcus spp. (EUCAST),30 mcg,23,-,23
Cefuroxime, Haemophilus influenzae (EUCAST),30 mcg,27,-,27
Cephalothin," Enterobacteriaceae, Staphylococcus spp.",30 mcg,18,15-17,14
Chloramphenicol," Enterobacteriaceae, Staphylococcus spp.",30 mcg,18,13-17,12
Chloramphenicol, Enterobacteriaceae (EUCAST),30 mcg,21,-,21
Chloramphenicol, Staphylococcus spp. (EUCAST),30 mcg,21,-,21
Ciprofloxacin," Enterobacteriaceae, P. aeruginosa, Acinetobacter & Staphylococcus spp.",5 mcg,21,16-20,15
Ciprofloxacin, Enterobacteriaceae (EUCAST),5 mcg,25,22-24,22
Ciprofloxacin, Pseudomonas spp. (EUCAST),5 mcg,25,22-24,22
Ciprofloxacin, Acinetobacter spp. (EUCAST),5 mcg,25,22-24,22
Ciprofloxacin, Staphylococcus spp. (EUCAST),5 mcg,22,-,22
Ciprofloxacin, Enterococcus spp. (EUCAST),5 mcg,28,26-27,26
Clindamycin, Staphylococcus spp.,2 mcg,21,15-20,14
Clindamycin, Staphylococcus spp. (EUCAST),2 mcg,22,19-21,19
Clindamycin, Streptococcus group A B C & G (EUCAST),2 mcg,19,-,19
Colistin Sulphate, Enterobacteriaceae & P. aeruginosa,10 mcg,11,-,10
Colistin Sulphate, Enterobacteriaceae (EUCAST),10 mcg,11,-,11
Colistin Sulphate, Pseudomonas spp. (EUCAST),10 mcg,11,-,11
Colistin Sulphate, Acinetobacter spp. (EUCAST),10 mcg,11,-,11
Co-trimoxazole (Trimethoprim/Sulphamethoxazole)," Enterobacteriaceae, Staphylococcus spp.",25 mcg (1.25/23.75),16,11-15,10
Co-trimoxazole (Trimethoprim/Sulphamethoxazole), Enterobacteriaceae (uncomplicated UTI only) (EUCAST),25 mcg (1.25/23.75),17,-,17
Co-trimoxazole (Trimethoprim/Sulphamethoxazole), Staphylococcus spp. (EUCAST),25 mcg (1.25/23.75),17,14-16,14
Erythromycin, Staphylococcus spp.,15 mcg,23,14-22,13
Erythromycin, Staphylococcus spp. (EUCAST),15 mcg,21,18-20,18
Erythromycin, Streptococcus group A B C & G (EUCAST),15 mcg,21,18-20,18
Gatifloxacin," Enterobacteriaceae, Staphylococcus spp.",5 mcg,18,15-17,14
Gentamicin," Enterobacteriaceae, P. aeruginosa, Acinetobacter & Staphylococcus spp.",10 mcg,15,13-14,12
Gentamicin, Enterobacteriaceae (EUCAST),10 mcg,17,14-16,14
Gentamicin, Staphylococcus spp. (EUCAST),10 mcg,18,-,18
Gentamicin, Enterococcus spp. (EUCAST),10 mcg,18,12-17,12
Gentamicin, Pseudomonas spp. (EUCAST),10 mcg,16,-,16
Gentamicin, Acinetobacter spp. (EUCAST),10 mcg,17,-,17
Imipenem," Enterobacteriaceae, P. aeruginosa, Acinetobacter & Staphylococcus spp.",10 mcg,16,14-15,13
Imipenem, Enterobacteriaceae (EUCAST),10 mcg,22,19-21,19
Imipenem, Pseudomonas spp. (EUCAST),10 mcg,20,17-19,17
Imipenem, Acinetobacter spp. (EUCAST),10 mcg,20,17-19,17
Levofloxacin," Enterobacteriaceae, Staphylococcus spp.",5 mcg,17,14-16,13
Levofloxacin, Enterobacteriaceae (EUCAST),5 mcg,20,17-19,17
Levofloxacin, Pseudomonas spp. (EUCAST),5 mcg,17,15-16,15
Levofloxacin, Staphylococcus spp. (EUCAST),5 mcg,20,17-19,17
Linezolid," Staphylococcus, Enterococcus spp.",30 mcg,21,-,20
Linezolid, Staphylococcus spp. (EUCAST),30 mcg,21,-,21
Linezolid, Enterococcus spp. (EUCAST),30 mcg,21,-,21
Linezolid, Streptococcus pneumoniae (EUCAST),30 mcg,21,-,21
Linezolid, Streptococcus group A B C & G (EUCAST),30 mcg,21,-,21
Meropenem," Enterobacteriaceae, P. aeruginosa, Acinetobacter & Staphylococcus spp.",10 mcg,16,14-15,13
Meropenem, Enterobacteriaceae (EUCAST),10 mcg,22,19-21,19
Meropenem, Pseudomonas spp. (EUCAST),10 mcg,19,14-18,14
Meropenem, Acinetobacter spp. (EUCAST),10 mcg,18,15-17,15
Meropenem, Staphylococcus spp. (EUCAST),10 mcg,25,-,25
Minocycline," Enterobacteriaceae, Staphylococcus spp.",30 mcg,19,15-18,14
Minocycline, Enterobacteriaceae (EUCAST),30 mcg,19,16-18,16
Minocycline, Staphylococcus spp. (EUCAST),30 mcg,19,16-18,16
Netilmicin," Enterobacteriaceae, P. aeruginosa, Acinetobacter & Staphylococcus spp.",30 mcg,15,13-14,12
Nitrofurantoin, Enterobacteriaceae,300 mcg,17,15-16,14
Nitrofurantoin, Enterobacteriaceae (EUCAST),300 mcg,20,-,20
Nitrofurantoin, Staphylococcus spp. (EUCAST),300 mcg,20,-,20
Nitrofurantoin, Enterococcus spp. (EUCAST),300 mcg,20,-,20
Norfloxacin," Enterobacteriaceae, Staphylococcus spp.",10 mcg,17,13-16,12
Norfloxacin, Enterobacteriaceae (EUCAST),10 mcg,17,14-16,14
Norfloxacin, Staphylococcus spp. (EUCAST),10 mcg,17,14-16,14
Ofloxacin," Enterobacteriaceae, Staphylococcus spp.",5 mcg,16,13-15,12
Oxacillin, Staphylococcus spp.,1 mcg,13,11-12,10
Oxacillin, Staphylococcus spp. (EUCAST),1 mcg,18,-,18
Penicillin G, Staphylococcus spp.,10 units,29,-,28
Penicillin G, Staphylococcus spp. (EUCAST),10 units,26,-,26
Penicillin G, Streptococcus pneumoniae (EUCAST),10 units,28,-,28
Piperacillin," Enterobacteriaceae, P. aeruginosa",100 mcg,21,18-20,17
Piperacillin/Tazobactam," Enterobacteriaceae, P. aeruginosa, Acinetobacter & Staphylococcus spp.",110 mcg (100/10),21,18-20,17
Piperacillin/Tazobactam, Enterobacteriaceae (EUCAST),110 mcg (100/10),20,17-19,17
Piperacillin/Tazobactam, Pseudomonas spp. (EUCAST),110 mcg (100/10),18,-,18
Polymyxin-B, Enterobacteriaceae & P. aeruginosa,300 units,12,-,11
Rifampicin, Staphylococcus spp.,5 mcg,20,17-19,16
Rifampicin, Staphylococcus spp. (EUCAST),5 mcg,20,17-19,17
Teicoplanin, Staphylococcus spp.,30 mcg,14,11-13,10
Teicoplanin, Staphylococcus spp. (EUCAST),30 mcg,19,15-18,15
Teicoplanin, Enterococcus spp. (EUCAST),30 mcg,19,16-18,16
Tetracycline," Enterobacteriaceae, Staphylococcus spp.",30 mcg,19,15-18,14
Tetracycline, Enterobacteriaceae (EUCAST),30 mcg,18,15-17,15
Tetracycline, Staphylococcus spp. (EUCAST),30 mcg,22,-,22
Ticarcillin, Enterobacteriaceae & P. aeruginosa,75 mcg,20,15-19,14
Ticarcillin/Clavulanic acid, Enterobacteriaceae & P. aeruginosa,85 mcg (75/10),20,15-19,14
Tigecycline, Enterobacteriaceae,15 mcg,18,15-17,14
Tigecycline, Staphylococcus spp.,15 mcg,19,16-18,15
Tigecycline, Enterococcus spp. (EUCAST),75 mcg,18,-,18
Tigecycline," Enterobacteriaceae, Enterococcus spp",15 mcg,18,15-17,15
Tigecycline, Staphylococcus spp.,15 mcg,18,-,18
Tigecycline," Streptococcus group A, B, C & G",15 mcg,19,16-18,16
Tigecycline, General QC,15 mcg,-,-,-
Tobramycin," Enterobacteriaceae, P. aeruginosa, Acinetobacter & Staphylococcus spp.",10 mcg,15,13-14,12
Tobramycin, Enterobacteriaceae (EUCAST),10 mcg,17,14-16,14
Tobramycin, Staphylococcus spp. (EUCAST),10 mcg,18,-,18
Tobramycin, Coagulase negative Staphylococci (EUCAST),10 mcg,22,-,22
Tobramycin, Pseudomonas spp. (EUCAST),10 mcg,16,-,16
Tobramycin, Acinetobacter spp. (EUCAST),10 mcg,17,-,17
Trimethoprim," Enterobacteriaceae, Staphylococcus spp",5 mcg,16,11-15,10
Trimethoprim, Enterobacteriaceae (EUCAST),5 mcg,18,15-17,15
Trimethoprim, Staphylococcus spp. (EUCAST),5 mcg,17,14-16,14
Trimethoprim, Enterococcus spp. (EUCAST),5 mcg,21,-,21
Vancomycin, Staphylococcus spp.,30 mcg,17,15-16,14
Vancomycin, Enterococcus spp.,30 mcg,17,15-16,14
Vancomycin, Staphylococcus spp. (EUCAST),30 mcg,17,-,17
Vancomycin, Enterococcus spp. (EUCAST),30 mcg,17,-,17`;

        let parsedData = [];
        let allAntibiotics = [];
        let selectedAntibiotic = '';

        // DOM Elements
        const antibioticSearchInput = document.getElementById('antibiotic-search');
        const antibioticOptionsContainer = document.getElementById('antibiotic-options');
        const antibioticDropdownContainer = document.getElementById('antibiotic-dropdown-container');
        const microorganismSelect = document.getElementById('microorganism');
        const discContentSelect = document.getElementById('discContent');
        const diameterInput = document.getElementById('diameter');
        const resultDisplay = document.getElementById('result-display');
        const resultIcon = document.getElementById('result-icon');
        const resultTitle = document.getElementById('result-title');
        const resultDescription = document.getElementById('result-description');
        const criteriaContainer = document.getElementById('criteria-container');
        const refSusceptible = document.getElementById('ref-susceptible');
        const refIntermediate = document.getElementById('ref-intermediate');
        const refResistant = document.getElementById('ref-resistant');
        const inhibitionZone = document.getElementById('inhibition-zone');
        const diameterLabel = document.getElementById('diameter-label');

        /**
         * Parses the raw CSV data into a structured JavaScript array of objects.
         */
        function parseCSV() {
            const lines = csvData.trim().split('\n');
            const headers = lines[0].split(',').map(h => h.trim());
            const regex = /,(?=(?:(?:[^"]*"){2})*[^"]*$)/;

            parsedData = lines.slice(1).map(line => {
                const values = line.split(regex).map(v => v.trim().replace(/"/g, ''));
                let obj = {};
                headers.forEach((header, i) => {
                    obj[header] = values[i] || '';
                });
                return obj;
            });
        }

        /**
         * Populates the custom searchable antibiotic dropdown with a given list of antibiotics.
         */
        function populateAntibioticOptions(antibioticList) {
            antibioticOptionsContainer.innerHTML = ''; // Clear existing options
            if (antibioticList.length === 0) {
                const noResultDiv = document.createElement('div');
                noResultDiv.textContent = 'No results found';
                noResultDiv.classList.add('p-2', 'text-gray-500');
                antibioticOptionsContainer.appendChild(noResultDiv);
                return;
            }
            antibioticList.forEach(antibiotic => {
                const optionDiv = document.createElement('div');
                optionDiv.textContent = antibiotic;
                optionDiv.classList.add('p-2', 'hover:bg-indigo-50', 'cursor-pointer', 'rounded');
                
                optionDiv.addEventListener('mousedown', () => {
                    antibioticSearchInput.value = antibiotic;
                    selectedAntibiotic = antibiotic;
                    antibioticOptionsContainer.classList.add('hidden');
                    updateMicroorganisms();
                });
                antibioticOptionsContainer.appendChild(optionDiv);
            });
        }

        /**
         * Updates dependent dropdowns when the antibiotic selection changes.
         */
        function updateMicroorganisms() {
            microorganismSelect.innerHTML = '<option value="">Select a microorganism</option>';
            microorganismSelect.disabled = true;
            discContentSelect.innerHTML = '<option value="">Select disc content</option>';
            discContentSelect.disabled = true;
            diameterInput.disabled = true;
            resetResultAndViz();

            if (selectedAntibiotic) {
                const microorganisms = [...new Set(parsedData
                    .filter(item => item['Antibiotic agent'] === selectedAntibiotic)
                    .map(item => item['Micro-organism']))];
                
                microorganisms.sort().forEach(micro => {
                    const option = document.createElement('option');
                    option.value = micro;
                    option.textContent = micro;
                    microorganismSelect.appendChild(option);
                });
                microorganismSelect.disabled = false;
            }
        }
        
        /**
         * Updates the disc content dropdown based on previous selections.
         */
        function updateDiscContent() {
            const selectedMicroorganism = microorganismSelect.value;
            discContentSelect.innerHTML = '<option value="">Select disc content</option>';
            discContentSelect.disabled = true;
            diameterInput.disabled = true;
            resetResultAndViz();

            if (selectedAntibiotic && selectedMicroorganism) {
                const discContents = [...new Set(parsedData
                    .filter(item => item['Antibiotic agent'] === selectedAntibiotic && item['Micro-organism'] === selectedMicroorganism)
                    .map(item => item['Disc Content']))];
                
                discContents.sort().forEach(content => {
                    const option = document.createElement('option');
                    option.value = content;
                    option.textContent = content;
                    discContentSelect.appendChild(option);
                });
                discContentSelect.disabled = false;
            }
        }

        /**
         * Enables the diameter input and triggers evaluation.
         */
        function enableDiameterInput() {
            const selectedDisc = discContentSelect.value;
            diameterInput.disabled = !selectedDisc;
            resetResultAndViz();
            if (selectedDisc) {
                evaluate();
            }
        }

        /**
         * Resets the result, criteria, and visualization displays.
         */
        function resetResultAndViz() {
            resultDisplay.classList.add('hidden');
            criteriaContainer.classList.add('hidden');
            resultDisplay.className = 'result-card p-4 rounded-lg hidden flex items-center space-x-3';
            resultTitle.textContent = '';
            resultDescription.textContent = '';
            refSusceptible.textContent = '-';
            refIntermediate.textContent = '-';
            refResistant.textContent = '-';
            updateVisualization(0, 'Unknown');
        }

        /**
         * Updates the petri dish visualization.
         */
        function updateVisualization(diameter, result) {
            const maxDiameter = 50; // An estimated max zone size for scaling
            const maxRadius = 95; // Max radius in SVG
            const discRadius = 6; // Antibiotic disc radius in SVG
            
            let zoneRadius = (diameter / 2) / (maxDiameter / 2) * maxRadius;
            if (zoneRadius < discRadius) zoneRadius = discRadius;
            if (zoneRadius > maxRadius) zoneRadius = maxRadius;

            inhibitionZone.setAttribute('r', zoneRadius);
            diameterLabel.textContent = `${diameter || 0} mm`;
            
            inhibitionZone.classList.remove('zone-susceptible', 'zone-intermediate', 'zone-resistant', 'zone-unknown');
            
            let iconClass = 'fa-question-circle';
            
            switch(result) {
                case 'Susceptible':
                    inhibitionZone.classList.add('zone-susceptible');
                    resultIcon.className = 'fa-solid fa-lg fa-check-circle';
                    break;
                case 'Intermediate':
                    inhibitionZone.classList.add('zone-intermediate');
                    resultIcon.className = 'fa-solid fa-lg fa-exclamation-circle';
                    break;
                case 'Resistant':
                    inhibitionZone.classList.add('zone-resistant');
                    resultIcon.className = 'fa-solid fa-lg fa-times-circle';
                    break;
                default:
                    inhibitionZone.classList.add('zone-unknown');
                    inhibitionZone.setAttribute('r', discRadius); // No zone if unknown or 0
                    resultIcon.className = 'fa-solid fa-lg fa-question-circle';
                    break;
            }
        }

        /**
         * Main evaluation function to classify the microorganism.
         */
        function evaluate() {
            const antibiotic = selectedAntibiotic;
            const microorganism = microorganismSelect.value;
            const discContent = discContentSelect.value;
            const diameter = parseFloat(diameterInput.value);

            resetResultAndViz();

            if (!antibiotic || !microorganism || !discContent) {
                 updateVisualization(0, 'Unknown');
                return;
            }

            const criteria = parsedData.find(item => 
                item['Antibiotic agent'] === antibiotic &&
                item['Micro-organism'] === microorganism &&
                item['Disc Content'] === discContent
            );

            if (!criteria) {
                updateVisualization(diameter || 0, 'Unknown');
                return;
            }

            const s_val = criteria['Sensitive (mm or more)'];
            const i_val = criteria['Intermediate (mm)'];
            const r_val = criteria['Resistant (mm or less)'];
            
            refSusceptible.textContent = s_val !== '-' ? `≥ ${s_val} mm` : 'N/A';
            refIntermediate.textContent = i_val !== '-' ? `${i_val} mm` : 'N/A';
            refResistant.textContent = r_val !== '-' ? `≤ ${r_val} mm` : 'N/A';
            criteriaContainer.classList.remove('hidden');

            if (isNaN(diameter)) {
                updateVisualization(0, 'Unknown');
                return;
            }

            let result = 'Unknown';
            let description = 'Could not determine the category based on the provided values.';
            let resultClass = 'result-unknown';

            const sensitive = parseFloat(s_val);
            const resistant = parseFloat(r_val);
            const intermediateRange = i_val.split('-').map(parseFloat);

            if (s_val !== '-' && diameter >= sensitive) {
                result = 'Susceptible';
                description = `A zone of ${diameter}mm is considered susceptible.`;
                resultClass = 'result-susceptible';
            } else if (r_val !== '-' && diameter <= resistant) {
                result = 'Resistant';
                description = `A zone of ${diameter}mm is considered resistant.`;
                resultClass = 'result-resistant';
            } else if (intermediateRange.length === 2 && !isNaN(intermediateRange[0]) && !isNaN(intermediateRange[1])) {
                if (diameter >= intermediateRange[0] && diameter <= intermediateRange[1]) {
                    result = 'Intermediate';
                    description = `A zone of ${diameter}mm is considered intermediate.`;
                    resultClass = 'result-intermediate';
                }
            }
            
            resultTitle.textContent = result;
            resultDescription.textContent = description;
            resultDisplay.className = `result-card ${resultClass} p-4 rounded-lg flex items-center space-x-3`;
            resultDisplay.classList.remove('hidden');

            updateVisualization(diameter, result);
        }

        /**
         * Sets up all the event listeners for the application.
         */
        function addEventListeners() {
            antibioticSearchInput.addEventListener('focus', () => {
                antibioticOptionsContainer.classList.remove('hidden');
            });

            document.addEventListener('click', (e) => {
                if (!antibioticDropdownContainer.contains(e.target)) {
                    antibioticOptionsContainer.classList.add('hidden');
                }
            });

            antibioticSearchInput.addEventListener('input', () => {
                const filter = antibioticSearchInput.value.toLowerCase();
                const filtered = allAntibiotics.filter(ab => ab.toLowerCase().includes(filter));
                populateAntibioticOptions(filtered);
                if (antibioticSearchInput.value === '') {
                    selectedAntibiotic = '';
                    updateMicroorganisms();
                }
            });
            
            antibioticSearchInput.addEventListener('blur', () => {
                setTimeout(() => {
                    const currentText = antibioticSearchInput.value;
                    const exactMatch = allAntibiotics.find(ab => ab.toLowerCase() === currentText.toLowerCase());

                    if (exactMatch) {
                        antibioticSearchInput.value = exactMatch;
                        if (selectedAntibiotic !== exactMatch) {
                            selectedAntibiotic = exactMatch;
                            updateMicroorganisms();
                        }
                    } else {
                        if(selectedAntibiotic){
                           antibioticSearchInput.value = selectedAntibiotic;
                        } else {
                           antibioticSearchInput.value = '';
                           selectedAntibiotic = '';
                           updateMicroorganisms();
                        }
                    }
                    if(!antibioticOptionsContainer.matches(':hover')){
                       antibioticOptionsContainer.classList.add('hidden');
                    }
                }, 150);
            });

            microorganismSelect.addEventListener('change', updateDiscContent);
            discContentSelect.addEventListener('change', enableDiameterInput);
            diameterInput.addEventListener('input', evaluate);
        }

        // Initial setup on window load
        window.onload = () => {
            parseCSV();
            allAntibiotics = [...new Set(parsedData.map(item => item['Antibiotic agent']))].sort();
            populateAntibioticOptions(allAntibiotics);
            addEventListeners();
            resetResultAndViz();
        };

    </script>
</body>
</html>
